{"version":3,"file":"knowit-instantblockpreview.js","sources":["../../Frontend/src/index.ts"],"sourcesContent":["import { LitElement, html, customElement, unsafeHTML} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport { UMB_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbWorkspaceUniqueType } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { UmbContextToken } from \"@umbraco-cms/backoffice/context-api\";\r\nimport { observeMultiple } from \"@umbraco-cms/backoffice/observable-api\";\r\n\r\n@customElement('knowit-instant-block-preview')\r\nexport class InstantBlockPreview extends UmbElementMixin(LitElement) {\r\n\r\n  \r\n  #currentValue : any | undefined = undefined;\r\n  #currentId : UmbWorkspaceUniqueType | undefined = undefined;\r\n  #propertyType: string | undefined = undefined;\r\n  #documentTypeId: string | undefined = undefined;\r\n  #label: string | undefined = undefined;\r\n  #loader = `<uui-loader style=\"margin-right: 20px\"></uui-loader> Loading preview...`;\r\n  #showLoader = false;\r\n  #htmlOutput = ``;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.#htmlOutput = this.blockBeam();\r\n    const UMB_BLOCK_GRID_ENTRY_CONTEXT = new UmbContextToken<any>('UmbBlockEntryContext')\r\n    const UMB_BLOCK_LIST_ENTRY_CONTEXT = new UmbContextToken<any>('UmbBlockEntryContext');\r\n\r\n    this.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n      this.#currentId = workspaceContext.getUnique();\r\n      this.#documentTypeId = workspaceContext.getContentTypeId();\r\n    });\r\n\r\n    this.consumeContext(UMB_PROPERTY_CONTEXT, (propertyContext) => {\r\n      this.#propertyType = propertyContext.getAlias();\r\n    \r\n      this.consumeContext(UMB_BLOCK_GRID_ENTRY_CONTEXT, (context) => {\r\n        this.observe(context.label, (label) => {\r\n          this.#label = label as string;\r\n          this.#htmlOutput = this.blockBeam();\r\n          this.requestUpdate();\r\n        });\r\n\r\n        this.observe(observeMultiple(context.content, propertyContext.value), ([content, currentValue]) => {\r\n          this.handleBlock(content, currentValue);\r\n        });\r\n\r\n      });\r\n\r\n      this.consumeContext(UMB_BLOCK_LIST_ENTRY_CONTEXT, (context) => {\r\n        this.observe(context.label, (label) => {\r\n          this.#label = label as string;\r\n          this.#htmlOutput = this.blockBeam();\r\n          this.requestUpdate();\r\n        });\r\n\r\n        this.observe(observeMultiple(context.content, propertyContext.value), ([content, currentValue]) => {\r\n          this.handleBlock(content, currentValue);\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  handleBlock(content : any, currentValue : any) {\r\n    this.#showLoader = true;\r\n    const obj = JSON.parse(JSON.stringify(currentValue));\r\n\r\n    obj.contentData = [content];\r\n\r\n    if(JSON.stringify(obj) === JSON.stringify(this.#currentValue)) {\r\n      return;\r\n    }\r\n\r\n    this.#currentValue = obj;\r\n\r\n    const payload = {\r\n\r\n      content: JSON.stringify(this.#currentValue),\r\n      contentId: this.#currentId,\r\n      propertyTypeAlias: this.#propertyType,\r\n      contentTypeId: this.#documentTypeId,\r\n    }\r\n    fetch('/api/blockpreview', {\r\n      method: 'POST',\r\n      body: JSON.stringify(payload),\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n    .then(response => response.json()).then(data => {\r\n      this.#showLoader = false;\r\n      if(data.html === \"blockbeam\")\r\n        this.#htmlOutput = this.blockBeam();  \r\n      else this.#htmlOutput = '<div style=\"border: 1px solid var(--uui-color-border,#d8d7d9); min-height: 50px;\">' + data.html + '</div>';\r\n      this.requestUpdate();\r\n    });\r\n\r\n  }\r\n\r\n  blockBeam() {\r\n    return `\r\n    <umb-ref-grid-block standalone href=\"\">\r\n      <span style=\"margin-right: 20px\">${this.#label}</span> ${this.#showLoader ? this.#loader : ''}\r\n\t\t</umb-ref-grid-block>`\r\n  }\r\n  render() {\r\n    return html`${unsafeHTML(this.#htmlOutput)}`;\r\n  }\r\n}\r\n\r\nexport default InstantBlockPreview;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'knowit-instant-block-preview': InstantBlockPreview;\r\n  }\r\n}"],"names":["_currentValue","_currentId","_propertyType","_documentTypeId","_label","_loader","_showLoader","_htmlOutput","InstantBlockPreview","UmbElementMixin","LitElement","__privateAdd","__privateSet","UMB_BLOCK_GRID_ENTRY_CONTEXT","UmbContextToken","UMB_BLOCK_LIST_ENTRY_CONTEXT","UMB_DOCUMENT_WORKSPACE_CONTEXT","workspaceContext","UMB_PROPERTY_CONTEXT","propertyContext","context","label","observeMultiple","content","currentValue","obj","__privateGet","payload","response","data","html","unsafeHTML","__decorateClass","customElement","InstantBlockPreview$1"],"mappings":"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"}